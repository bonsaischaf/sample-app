{
  "builders": [
    {
      "type": "azure-arm",

      "managed_image_name": "{{ user `IMAGE_NAME` }}",
      "managed_image_resource_group_name": "{{ user `IMAGE_RESOURCE_GROUP_NAME` }}",

      "subscription_id": "{{ user `PACKER_SUBSCRIPTION_ID` }}",
      "client_id": "{{ user `PACKER_CLIENT_ID` }}",
      "client_secret": "{{ user `PACKER_CLIENT_SECRET` }}",
      "tenant_id": "{{ user `PACKER_TENANT_ID` }}",


      "os_type": "Linux",
      "image_publisher": "Canonical",
      "image_offer": "UbuntuServer",
      "image_sku": "16.04-DAILY-LTS",

      "vm_size": "Standard_A0",
      "location": "{{ user `PACKER_LOCATION` }}",

      "azure_tags": {
        "dept": "engineering"
      }
    }
  ],
  "provisioners": [
       {
         "destination": "/tmp/sample-app.jar",
         "source": "target/gs-spring-boot-0.1.0.jar",
         "type": "file"
       },
       {
        "execute_command": "chmod +x {{ .Path }}; {{ .Vars }} sudo -E sh '{{ .Path }}'",
        "scripts": [
           "packer/scripts/create_admin.sh",
           "packer/scripts/java.sh",
           "packer/scripts/deploy.sh",
           "packer/scripts/deprovision.sh"
         ],
       "inline_shebang": "/bin/sh -x",
       "type": "shell"
       }
   ],

  "variables": {

    "PACKER_SUBSCRIPTION_ID": "{{ env `PACKER_SUBSCRIPTION_ID` }}",
    "PACKER_CLIENT_ID":       "{{ env `PACKER_CLIENT_ID` }}",
    "PACKER_CLIENT_SECRET":   "{{ env `PACKER_CLIENT_SECRET` }}",
    "PACKER_LOCATION":        "{{ env `PACKER_LOCATION` }}",
    "PACKER_TENANT_ID":       "{{ env `PACKER_TENANT_ID` }}",
    "PACKER_OBJECT_ID":       "{{ env `PACKER_OBJECT_ID` }}",

    "IMAGE_RESOURCE_GROUP_NAME": "cschaffe-img",
    "IMAGE_NAME": "{{ env `TF_VAR_IMAGE_NAME` }}",
    }
}
